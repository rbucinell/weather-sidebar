---
import Layout from '../layouts/defaultlayout.astro';
import Current from '../components/current.astro';
import DailyForecast from '../components/DailyForecast.astro';
import HourlyForecast from '../components/HourlyForecast.astro';
import Alerts from '../components/Alerts.astro';
//process.env["NODE_TLS_REJECT_UNAUTHORIZED"] = "0";

let date = new Date();
date.setDate(date.getDate()+1);
const formattedDate = new Intl.DateTimeFormat('en-US').format(date);
let end = new Date(date);
end.setDate(end.getDate()+3);
let formattedEnd = new Intl.DateTimeFormat('en-US').format(end);
//dt=${formattedDate}&end_dt=${formattedEnd}&
const weatherResponse = await fetch(`https://api.weatherapi.com/v1/forecast.json?days=3&aqi=yes&q=14450&alerts=yes&key=${import.meta.env.weatherapiKey}`);
console.log( `https://api.weatherapi.com/v1/forecast.json?days=3&aqi=yes&q=14450&alerts=yes&key=${import.meta.env.weatherapiKey}` )
const json = await weatherResponse.json();
const current = json.current;
const forecast = json.forecast;
const alerts = json.alerts;
---
<Layout>
    <h1 class="p-2 text-center text-5xl font-bold" id="datetime" onload=""></h1>
    <div class="flex flex-col gap-6 ">
        <Current data={current} forecast={forecast.forecastday[0]}/>
        <Alerts data={alerts} />
        <HourlyForecast data={forecast.forecastday[0]} />
        <DailyForecast data={forecast} />
    </div>

    <script>
        import { formatDatetime } from "../scripts/util";
        let mins = 0;
        const datetime = document.querySelector("#datetime");
        if( datetime ){
            datetime.textContent = formatDatetime(new Date() );
            setInterval(()=> {
                mins++;
                datetime.textContent = formatDatetime(new Date());
                if( mins % 5 === 0 ) window.location.reload();
            }, 60 * 1000);
        }
    </script>
</Layout>